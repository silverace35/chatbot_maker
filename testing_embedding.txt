# Application Electron Chat LLM Local

Application desktop Electron + Vite + React (TypeScript) pour chatter avec un LLM local.

> **Note**: Ce projet est en Phase 2 de d√©veloppement. Le MVP de base est fonctionnel, et la persistance PostgreSQL est maintenant disponible.

## Architecture

```
electron_template/
‚îú‚îÄ‚îÄ electron/           # Process main + preload Electron
‚îú‚îÄ‚îÄ renderer/          # Application React (frontend)
‚îú‚îÄ‚îÄ backend/           # API Node/TS pour LLM local
‚îú‚îÄ‚îÄ docker-compose.yml # Orchestration Postgres/Ollama/Qdrant
‚îú‚îÄ‚îÄ MVP_PLAN.md        # Plan MVP (phases 0-8)
‚îî‚îÄ‚îÄ PHASE2_GUIDE.md    # Guide Phase 2 (persistance, Ollama, RAG)
```

### Stack technique

- **Frontend**: React 19, TypeScript, Vite, Material-UI (MUI), React Router
- **Backend**: Node.js, TypeScript, Express, PostgreSQL
- **Desktop**: Electron 39
- **Persistance**: Stockage en m√©moire (MVP) ou PostgreSQL (Phase 2.1) ‚úÖ
- **LLM**: Stub (actuel) ‚Üí Ollama (Phase 2.2, √† venir)
- **Infrastructure**: Docker Compose pour services backend

## Installation

### Pr√©requis

- Node.js 18+ et npm

### Installation des d√©pendances

```bash
# Root (scripts d'orchestration)
npm install

# Renderer (frontend React)
cd renderer && npm install && cd ..

# Backend (API)
cd backend && npm install && cd ..
```

## Utilisation

### Mode d√©veloppement

**Option 1: Lancer tout ensemble (recommand√©)**

```bash
npm run dev:all
```

Cette commande lance en parall√®le:
- Le backend (port 4000)
- Le renderer Vite (port 5173)
- Electron

**Option 2: Lancer s√©par√©ment**

Terminal 1 (Backend):
```bash
cd backend
npm run dev
```

Terminal 2 (Frontend + Electron):
```bash
npm run dev
```

### Acc√©der √† l'application

Une fois lanc√©, l'application Electron s'ouvre automatiquement. Vous pouvez:

1. **Naviguer vers "Chat LLM"** dans la barre de navigation
2. **Cr√©er un profil** avec un nom et un contexte syst√®me
3. **Envoyer des messages** et recevoir des r√©ponses du stub LLM

### Tester l'API directement

Vous pouvez tester le backend avec curl:

```bash
# Health check
curl http://localhost:4000/health

# Cr√©er un profil
curl -X POST http://localhost:4000/api/profile \
  -H "Content-Type: application/json" \
  -d '{"name":"Assistant Python","system_context":"Tu es un expert Python."}'

# Lister les profils
curl http://localhost:4000/api/profile

# Envoyer un message
curl -X POST http://localhost:4000/api/chat/send \
  -H "Content-Type: application/json" \
  -d '{"profileId":"<ID_DU_PROFIL>","message":"Bonjour!"}'
```

### Tester depuis la console Electron

Ouvrez les DevTools (Ctrl+Shift+I) et testez:

```javascript
// V√©rifier que l'API est disponible
console.log(window.api)

// Lister les profils
await window.api.profile.list()

// Cr√©er un profil
await window.api.profile.create({
  name: "Test",
  system_context: "Tu es un assistant utile."
})

// Envoyer un message
await window.api.chat.sendMessage({
  profileId: "profile_...",
  message: "Bonjour!"
})
```

## üî® Build

### Build du renderer (frontend)

```bash
npm run build:renderer
```

Les fichiers build√©s seront dans `renderer/dist/`

### Build du backend

```bash
npm run build:backend
```

Les fichiers compil√©s seront dans `backend/dist/`

## üìù Fonctionnalit√©s

### Phase 1 (MVP) - Compl√©t√©e ‚úÖ

- ‚úÖ Backend API REST avec Express
- ‚úÖ Stockage en m√©moire (profils + sessions)
- ‚úÖ Service LLM stub (echo avec contexte du profil)
- ‚úÖ Int√©gration Electron via preload/contextBridge
- ‚úÖ Interface chat React avec Material-UI
- ‚úÖ Gestion de profils (cr√©ation, s√©lection)
- ‚úÖ Contexte syst√®me (system_context) pour personnaliser les r√©ponses
- ‚úÖ Historique de conversation par session
- ‚úÖ Architecture orient√©e features (modules/services/shared)

### Phase 2 - En cours üöß

- ‚úÖ **Phase 2.1**: Persistance PostgreSQL (compl√©t√©e)
  - Store factory avec switch memory/postgres
  - Docker Compose pour orchestration
  - Sch√©ma complet avec migrations
  - Fallback automatique vers memory si DB indisponible
- ‚è≥ **Phase 2.2**: Int√©gration Ollama (LLM r√©el)
- ‚è≥ **Phase 2.3**: RAG avec Qdrant
- ‚è≥ **Phase 2.4**: Upload et indexation de documents
- ‚è≥ **Phase 2.5**: Import/Export de profils
- ‚è≥ **Phase 2.6**: Build production avec electron-builder
- ‚è≥ **Phase 2.7**: Documentation et tests

## üìö Documentation

- **[MVP_PLAN.md](./MVP_PLAN.md)**: Plan d√©taill√© du MVP (phases 0-8)
- **[PHASE2_GUIDE.md](./PHASE2_GUIDE.md)**: Guide Phase 2 - Persistance, Ollama, RAG
- **[QUICK_START.md](./QUICK_START.md)**: Guide de d√©marrage rapide
- **[renderer/README.md](./renderer/README.md)**: Documentation de l'architecture frontend

## üéØ Principes d'architecture

### Frontend (renderer/)

- **Orient√© features**: modules s√©par√©s par domaine m√©tier (chat, jokes, etc.)
- **Services s√©par√©s de l'UI**: logique m√©tier dans services/, UI dans modules/
- **Composants auto-contenus**: chaque composant dans son dossier avec .tsx, .types.ts, .styles.ts, .test.tsx
- **Typage strict**: TypeScript avec strict mode
- **Paths aliases**: `@/` pointe vers `src/`

### Backend (backend/)

- **Architecture en couches**: routes ‚Üí services ‚Üí store
- **Types partag√©s**: mod√®les dans models/
- **Stockage abstrait**: interface memoryStore facilite la migration vers DB
- **Logging**: requ√™tes logg√©es pour faciliter le debug

### Electron

- **Isolation de contexte**: contextIsolation activ√©
- **Pas de nodeIntegration**: s√©curit√© renforc√©e
- **API expos√©e via preload**: utilisation de contextBridge
- **Communication HTTP**: fetch du renderer vers backend (pas d'IPC pour l'API)

## üêõ Debug

### Le backend ne d√©marre pas

V√©rifiez que le port 4000 est libre:
```bash
lsof -i :4000
```

### Le renderer ne se connecte pas au backend

1. V√©rifiez que le backend est d√©marr√©: `curl http://localhost:4000/health`
2. Ouvrez les DevTools Electron et regardez la console
3. V√©rifiez que `window.api` existe

### Erreur "API not available"

Cela signifie que le preload n'a pas expos√© l'API correctement. Red√©marrez Electron.

## üìÑ Limitations du MVP

- **Donn√©es volatiles**: Les profils et conversations sont perdus au red√©marrage
- **Stub LLM**: Les r√©ponses sont mock√©es, pas de vrai LLM pour le moment
- **Pas de persistance**: Aucune base de donn√©es
- **Pas de RAG**: Pas de recherche vectorielle ou d'indexation de documents
- **Un seul utilisateur**: Pas de gestion multi-utilisateurs

Ces limitations seront lev√©es dans la Phase 2 du d√©veloppement.

## üîê S√©curit√©

- ‚úÖ Context isolation activ√©
- ‚úÖ Node integration d√©sactiv√©
- ‚úÖ API expos√©e via contextBridge (s√©curis√©)
- ‚ö†Ô∏è Pas d'authentification backend (OK pour usage local)
- ‚ö†Ô∏è CORS ouvert (OK pour d√©veloppement local)

## üìû Support

Pour toute question, r√©f√©rez-vous au fichier [MVP_PLAN.md](./MVP_PLAN.md) qui contient:
- Le d√©tail de toutes les phases d'impl√©mentation
- Les points de validation
- Les d√©cisions d'architecture
- La roadmap pour la Phase 2
